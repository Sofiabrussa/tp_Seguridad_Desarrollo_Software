<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/static/css/cuenta.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&family=Trocchi&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header-container">
        <img src="/static/resources/images/logopng.png" alt="BitStake" class="header-logo">
        <h1 class="header-title">MI CUENTA</h1>
    </header>
    <div class="container-principal">
        <aside class="container-sidebar">
            <p>MI CARTERA</p>
            <button class="button button-deposito active">Hacer un deposito</button>
            <button class="button button-retirar">Retirar fondos</button>
            <button class="button button-transacciones">Transacciones</button>
            <p>PERFIL</p>
            <button class="button button-personales">Datos personales</button>
            <p>ADICIONAL</p>
            <button class="button button-invitacion">Invite a sus amigos</button>
            <button class="button button-atencion">Atencion al cliente</button>

            <button class="button" onclick="window.location.href='/logout'">Cerrar sesión</button>
        </aside>
        <div class="container-screen"></div>
    </div>

</body>
<script>
    var emailUsuario  = "{{ email }}";
    var usuarioNombre = "{{ username }}";
    var csrfToken     = "{{ csrf_token }}";

    document.addEventListener("DOMContentLoaded", () => {
        const screen = document.querySelector(".container-screen");

        // --- Pantalla depósito (por defecto) ---
        const divDeposito = document.createElement("div");
        divDeposito.classList.add("screen-deposito");
        divDeposito.innerHTML = `
            <p>Seleccione el método de pago para recargar su cuenta:</p>
            <div class="container-deposito-metodos">
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/mercadoPago.jpg"/></a>
                    <p class="footer">Mercado Pago</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/transferenciaBancaria.jpg"/></a>
                    <p class="footer">Transferencia Bancaria</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/astroPay.jpg"/></a>
                    <p class="footer">Astro Pay</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/bitcoin.jpg"/></a>
                    <p class="footer">Bitcoin</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/monero.png"/></a>
                    <p class="footer">Monero</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/ethereum.jpg"/></a>
                    <p class="footer">Ethereum</p>
                </div>
            </div>
        `;
        screen.appendChild(divDeposito);

        // --- Pantalla retirar fondos ---
        const divRetirar = document.createElement("div");
        divRetirar.classList.add("screen-deposito");
        divRetirar.innerHTML = `
            <p>Seleccione un método de retiro:</p>
            <div class="container-deposito-metodos">
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/mercadoPago.jpg"/></a>
                    <p class="footer">Mercado Pago</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/transferenciaBancaria.jpg"/></a>
                    <p class="footer">Transferencia Bancaria</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/astroPay.jpg"/></a>
                    <p class="footer">Astro Pay</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/lemon_cash.png"/></a>
                    <p class="footer">Lemon cash</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/netteler.jpg"/></a>
                    <p class="footer">Monero</p>
                </div>
                <div class="metodo">
                    <a href=""><img src="/static/resources/images/bybit.png"/></a>
                    <p class="footer">Bybit</p>
                </div>
            </div>
        `;

        // --- Pantalla transacciones ---
        const divTransacciones = document.createElement("div");
        divTransacciones.classList.add("transacciones-screen");
        divTransacciones.innerHTML = `
            <div>
                <h1>Historial de transacciones</h1>
                <table>
                    <tr>
                        <th>Fecha</th>
                        <th>Tipo</th>
                        <th>Monto</th>
                        <th>Método</th>
                    </tr>
                    <tr>
                        <td>17/11/2025  15:45</td>
                        <td>Ganancia</td>
                        <td>+ARS 2.400</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>17/11/2025  15:10</td>
                        <td>Apuesta</td>
                        <td>-ARS 1.000</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>17/11/2025  14:32</td>
                        <td>Depósito</td>
                        <td>+ARS 5.000</td>
                        <td>Transferencia bancaria</td>
                    </tr>
                </table>
            </div>
        `;

        // --- Pantalla datos personales ---
        const divPersonales = document.createElement("div");
        divPersonales.classList.add("personales-screen");
        divPersonales.innerHTML = `
            <h1>Datos personales</h1>
            <form id="form-email">
                <h2>Cuenta</h2>

                <label>Usuario actual</label>
                <input value="${usuarioNombre}" disabled />

                <label>Contraseña</label>
                <input type="password" value="password" disabled />

                <label>Email actual</label>
                <input id="email-actual" value="${emailUsuario}" disabled />

                <label>Nuevo email</label>
                <input name="new_email" type="email" placeholder="Ingrese un nuevo email"/>

                <button class="button">Guardar</button>
            </form>
        `;

        const formEmail = divPersonales.querySelector("#form-email");
        formEmail.addEventListener("submit", function(e) {
            e.preventDefault();

            const newEmail = formEmail.querySelector("input[name='new_email']").value;

            fetch("/change-email", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body:
                    /* Aca se manda el nuevo email y el token para que luego se compare */
                    "new_email=" + encodeURIComponent(newEmail) +
                    "&csrf_token=" + encodeURIComponent(csrfToken)
            })
            .then(r => r.text())
            .then(msg => {
                document.getElementById("email-actual").value = newEmail;
                emailUsuario = newEmail;

                alert("Email cambiado con éxito.");
                formEmail.querySelector("input[name='new_email']").value = "";
            })
            .catch(err => {
                alert("Error al cambiar email.");
                console.error(err);
            });
        });

        // --- Pantalla invitación ---
        const divinvitacion = document.createElement("div");
        divinvitacion.classList.add("invitacion-screen");
        divinvitacion.innerHTML = `
            <h2>¡Afíliese y empiece a ganar!</h2>
            <p>Construya una red de varios niveles al invitar a sus amigos que, a su vez, remiten a sus amigos</p>
            <div>
                <h3>¿Cómo funciona?</h3>
                <ul>
                    <li>Usted invita a sus amigos.</li>
                    <li>Sus amigos se registran, depositan fondos y hacen apuestas.</li>
                    <li>¡Usted recibe su recompensa!</li>
                </ul>
                <p>Al remitir a sus amigos, construirá una red de múltiples niveles. En cada nivel ganará un porcentaje del beneficio neto.</p>
                <div>
                    <input type="checkbox"/>
                    <a href="#">Acepto los Términos y Condiciones.</a>
                </div>
            </div>
        `;

        // --- Pantalla atención al cliente ---
        const divAtencion = document.createElement("div");
        divAtencion.classList.add("atencion-screen");
        divAtencion.innerHTML = `
            <div>
                <h3>Consultas sobre pagos</h3>
                <p>Haga una consulta o acceda al historial de consultas</p>
                <button class="button">Consulta sobre pagos</button>
            </div>
            <div>
                <h3>Consulta online</h3>
                <p>Haga sus consultas directamente en el chat</p>
                <button class="button">Escriba un mensaje</button>
            </div>
        `;

        // --- Manejo de botones del sidebar ---
        let buttons = document.querySelectorAll(".button");
        buttons.forEach(b => {
            b.addEventListener("click", (e) => {
                // Evitar que el botón de cerrar sesión se mezcle
                if (b.getAttribute("onclick")) {
                    return;
                }

                buttons.forEach(btn => btn.classList.remove("active"));
                b.classList.add("active");

                screen.innerHTML = "";

                if (b.classList.contains("button-deposito")) {
                    screen.appendChild(divDeposito);
                } else if (b.classList.contains("button-retirar")) {
                    screen.appendChild(divRetirar);
                } else if (b.classList.contains("button-transacciones")) {
                    screen.appendChild(divTransacciones);
                } else if (b.classList.contains("button-personales")) {
                    screen.appendChild(divPersonales);
                } else if (b.classList.contains("button-invitacion")) {
                    screen.appendChild(divinvitacion);
                } else if (b.classList.contains("button-atencion")) {
                    screen.appendChild(divAtencion);
                }
            });
        });
    });
</script>
</html>
